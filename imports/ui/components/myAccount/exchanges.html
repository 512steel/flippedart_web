<template name="userExchanges">
    {{#if currentUser }}
        <div class="col-sm-12">
            <h1>Your Exchanges</h1>
            <div class="row">
                <div class="col-md-3 col-sm-6 col-xxs-12">
                    <h2>Requested:</h2>
                    {{#unless cursorNotEmpty requestedEx}}<p>You haven't requested any items</p>{{/unless}}
                    <div class="push-down">
                        {{#each requestedEx}}
                            <div class="clearfix">
                                {{> exchangeListing }}
                                <hr>
                            </div>
                        {{/each}}
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 col-xxs-12">
                    <h2>Pending:</h2>
                    {{#unless cursorNotEmpty pendingEx}}<p>You don't have any pending exchanges</p>{{/unless}}
                    <div class="push-down">
                        {{#each pendingEx}}
                            <div class="clearfix">
                                {{> exchangeListing }}
                                <hr>
                            </div>
                        {{/each}}
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 col-xxs-12">
                    <h2>Completed:</h2>
                    {{#unless cursorNotEmpty completedEx}}<p>You haven't completed any exchanges</p>{{/unless}}
                    <div class="push-down">
                        {{#each completedEx}}
                            <div class="clearfix">
                                {{> exchangeListing }}
                                <hr>
                            </div>
                        {{/each}}
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 col-xxs-12">
                    <h2>Cancelled:</h2>
                    {{#unless cursorNotEmpty allCancelledEx}}<p>You don't have any cancelled exchanges</p>{{/unless}}
                    <div class="push-down">
                        {{#each allCancelledEx}}
                            <div class="clearfix">
                                {{> exchangeListing }}
                                <hr>
                            </div>
                        {{/each}}
                    </div>
                </div>
            </div>
        </div>
    {{else}}
        {{> signUpCTA }}
    {{/if}}
</template>


<template name="exchangeListing">
    {{#if isRequestee}}
        {{> requesteeExchangeListing }}
    {{else}}
        {{> requesterExchangeListing }}
    {{/if}}
    <script>$('[data-toggle="tooltip"]').tooltip({container: 'body'});</script>
</template>

<template name="requesteeExchangeListing">
    <div class="exchange-action-buttons">
        {{#unless isCancelled}}
                {{#if isCompleted}}
                    <form class="exchange-advance">
                        <input disabled value="{{advanceButtonCopy}}" class="btn btn-success"
                               data-toggle="tooltip"
                               data-placement="top"
                               title="You've completed the exchange!"/>
                    </form>
                {{else}}
                    <form class="exchange-advance">
                        <input type="submit" value="{{advanceButtonCopy}}" class="btn btn-success"
                               data-toggle="tooltip"
                               data-placement="top"
                               title="Advance the exchange process.  Mark it 'pending' if you'd like to
                                approve the request.  Only mark it 'completed' once your items have
                                physically changed hands."/>
                    </form>
                    <form class="exchange-decline">
                        <input type="submit" value="decline" class="btn btn-danger"
                               data-toggle="tooltip"
                               data-placement="top"
                               title="Choose not to proceed with this exchange."/>
                    </form>
                {{/if}}
        {{else}}
            <input value="{{isCancelledCopy}}" class="btn btn-danger exchange-decline" disabled
                   data-toggle="tooltip"
                   data-placement="top"
                   title="This exchange has been cancelled."/>
        {{/unless}}
    </div>
    <p class="clearfix push-down-sm"><a href="{{pathFor 'chronologicalUserPosts' username=requesterUsername}}">{{requesterUsername}}</a> asked to check out <a href="{{pathFor 'userSingleExchange' exchangeId=_id}}">{{#if isMultipleItems}}some items{{else}}an item{{/if}}</a> from you {{dateTimeAgo createdAt}}</p>
</template>
<template name="requesterExchangeListing">
    <div class="exchange-action-buttons">
        {{#unless isCancelled}}
                {{#if isCompleted}}
                    <form class="exchange-advance">
                        <input disabled value="{{advanceButtonCopy}}" class="btn btn-success"
                               data-toggle="tooltip"
                               data-placement="top"
                               title="You've completed this exchange!"/>
                    </form>
                {{else}}
                    <input disabled value="{{exchangeState}}" class="btn btn-success exchange-advance"
                           data-toggle="tooltip"
                           data-placement="top"
                           title="You've made a request for some items."/>
                    <form class="exchange-cancel">
                        <input type="submit" value="cancel request" class="btn btn-danger"
                               data-toggle="tooltip"
                               data-placement="top"
                               title="Cancel your request."/>
                    </form>
                {{/if}}
        {{else}}
            <input value="{{isCancelledCopy}}" class="btn btn-danger" disabled
                   data-toggle="tooltip"
                   data-placement="top"
                   title="This exchange has been cancelled."/>
        {{/unless}}
    </div>
    <p class="clearfix push-down-sm">You asked to check out <a href="{{pathFor 'userSingleExchange' exchangeId=_id}}">{{#if isMultipleItems}}some items{{else}}an item{{/if}}</a> from <a href="{{pathFor 'chronologicalUserPosts' username=requesteeUsername}}">{{requesteeUsername}}</a> {{dateTimeAgo createdAt}}</p>
</template>


<template name="userSingleExchange">
    {{#unless isExchangeMember}}
        {{> signUpCTA }}
    {{else}}
        <h1>Your exchange with {{#with exchange}}{{#if isRequestee}}{{requesterUsername}}{{else}}{{requesteeUsername}}{{/if}}{{/with}} </h1>
        {{#with exchange}}
            <div class="push-down">
                {{> exchangeListing }}
            </div>
        {{/with}}
        <div class="push-down">
            {{#each items}}
                <h4>
                    <a href="{{pathFor 'singleItemPage' exchangeItemId=this._id}}">
                        {{this.title}}{{#if itemHasTag}}({{this.tag}}){{/if}}
                        {{#if itemHasDescription}}| {{this.description}}{{/if}}
                    </a>
                </h4>
            {{/each}}
        </div>
        <div class="shift-down">
            {{#with exchange}}
                {{#if isRequestee}}
                    <p><a class="btn btn-default" href="{{pathFor 'chatWindow' username=requesterUsername}}">chat with {{requesterUsername}}</a></p>
                {{else}}
                    <p><a class="btn btn-default" href="{{pathFor 'chatWindow' username=requesteeUsername}}">chat with {{requesteeUsername}}</a></p>
                {{/if}}
            {{/with}}
            <p><a class="btn btn-default" href="{{pathFor 'userExchanges'}}">back to your exchanges</a></p>
        </div>
    {{/unless}}
</template>