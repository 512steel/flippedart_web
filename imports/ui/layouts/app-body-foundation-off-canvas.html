<template name="App_body">
    {{#HammerTouchArea gestureMap=templateGestures}}

        <div class="off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

                <!-- off-canvas title bar for 'small' screen -->
                <div class="title-bar" data-responsive-toggle="widemenu" data-hide-for="medium">
                    <div class="title-bar-left">
                        <a href="{{pathFor 'static.home'}}">
                            <a href="{{pathFor 'static.home' query='explore=true'}}"
                               style="padding-top:.2rem;padding-bottom:.2rem;">
                                <img src="/flippedart_white_smaller.png"/>
                            </a>
                        </a>
                    </div>
                    <div class="title-bar-right">
                        <button class="menu-icon" type="button" data-open="offCanvasRight" style="transform:translateY(50%);"></button>
                    </div>
                </div>

                <!-- off-canvas right menu -->
                <div class="off-canvas position-right" id="offCanvasRight" data-off-canvas data-position="right">

                    <button class="float-right push-down-small padded" aria-label="Close menu" type="button" data-close>
                        <span class="" aria-hidden="true">X</span>
                    </button>

                    <ul class="vertical menu text-center font-truenorth">

                        {{#if currentUser}}
                            {{# if hasUserAttributes}}
                                <li class="{{isActiveRoute 'profile.page'}}">
                                    <a href="{{pathFor 'profile.page' username=currentUsername}}" class=""
                                       data-close>{{currentUsername}}</a>
                                </li>
                                <li class="{{isActiveRoute 'profile.projects'}}">
                                    <a href="{{pathFor 'profile.projects' username=currentUsername}}" data-close>My
                                        projects</a>
                                </li>
                                <li class="{{isActiveRoute 'exchanges.user'}}">
                                    <a href="{{pathFor 'exchanges.user' username=currentUsername}}" data-close>My
                                        exchanges</a>
                                </li>
                                <li class="{{isActiveRoute 'chatSessions.list'}}">
                                    <a href="{{pathFor 'chatSessions.list'}}" data-close>My messages</a>
                                </li>
                            {{/if}}
                        {{else}}
                            <div class="menu button-group expanded">
                                <li>
                                    <a href="{{pathFor 'signin'}}" class="button primary hollow"
                                       data-close>{{_ 'Sign In'}}</a>
                                </li>
                                <li>
                                    <a href="{{pathFor 'join'}}" class="button primary hollow"
                                       data-close>{{_ 'Join'}}</a>
                                </li>
                            </div>
                        {{/if}}


                        {{#if currentUser}}
                            {{# if hasUserAttributes}}

                                <li class="{{isActiveRoute 'notifications.page'}}" data-close>
                                    <a href="{{pathFor 'notifications.page'}}">
                                        Notifications ({{userNotificationsCount}})
                                    </a>
                                </li>

                                <!--<li>
                                    <ul class="dropdown menu" data-dropdown-menu>
                                        <li class="has-submenu">
                                            <a>Notifications ({{userNotificationsCount}})</a>
                                            <ul class="submenu menu vertical" data-submenu>
                                                {{#each userNotifications}}
                                                    <li class="padded">
                                                        {{> notification_card}}
                                                    </li>
                                                    <hr>
                                                {{/each}}

                                    {{#if userHasNotifications}}
                                                    <li class="notifications-clear-all padded"><a>Clear all notifications</a></li>
                                                {{else}}
                                                    <li class="padded">You don't have any notifications</li>
                                                {{/if}}
                                            </ul>
                                        </li>
                                    </ul>
                                </li>-->
                                <!--
                                <li class="{{isActiveRoute 'explore.page'}}" data-close><a href="{{pathFor 'explore.page'}}">Explore</a></li>
-->
                                <li class="{{isActiveRoute 'static.make'}}" data-close><a
                                        href="{{pathFor 'static.make'}}">Make</a></li>
                                <li class="{{isActiveRoute 'static.about'}}" data-close><a
                                        href="{{pathFor 'static.about'}}">About</a></li>
                                <li class="{{isActiveRoute 'static.donate'}}" data-close><a
                                        href="{{pathFor 'static.donate'}}">Donate</a></li>
                            {{/if}}
                        {{else}}
                            <!--
                                <li class="{{isActiveRoute 'explore.page'}}" data-close><a href="{{pathFor 'explore.page'}}">Explore</a></li>
-->
                            <li class="{{isActiveRoute 'static.make'}}" data-close><a href="{{pathFor 'static.make'}}">Make</a></li>
                            <li class="{{isActiveRoute 'static.about'}}" data-close><a
                                    href="{{pathFor 'static.about'}}">About</a></li>
                            <li class="{{isActiveRoute 'static.donate'}}" data-close><a
                                    href="{{pathFor 'static.donate'}}">Donate</a></li>
                        {{/if}}


                        {{#if currentUser}}
                            <li><a class="js-logout" data-close>{{_ 'Logout'}}</a></li>
                        {{/if}}

                    </ul>
                </div>

                <!-- "wider" top-bar menu for 'medium' and up -->
                <div id="widemenu" class="top-bar font-truenorth">
                    <div class="top-bar-left">
                        <ul class="menu">
                            <li class="menu-logo-image">
                                <a href="{{pathFor 'static.home' query='explore=true'}}"
                                   style="padding-top:.2rem;padding-bottom:.2rem;">
                                    <img src="/flippedart_white_small.png"/>
                                </a>
                            </li>
                            {{#if currentUser}}
                                {{#unless hasUserAttributes}}

                                {{else}}
                                    <!--
                                    <li class="{{isActiveRoute 'explore.page'}}"><a href="{{pathFor 'explore.page'}}">Explore</a></li>
-->
                                    <li class="{{isActiveRoute 'static.make'}}"><a href="{{pathFor 'static.make'}}">Make</a></li>
                                    <li class="{{isActiveRoute 'static.about'}}"><a href="{{pathFor 'static.about'}}">About</a>
                                    </li>
                                {{/unless}}
                            {{else}}
                                <!--
                                <li class="{{isActiveRoute 'explore.page'}}"><a href="{{pathFor 'explore.page'}}">Explore</a></li>
-->
                                <li class="{{isActiveRoute 'static.make'}}"><a href="{{pathFor 'static.make'}}">Make</a></li>
                                <li class="{{isActiveRoute 'static.about'}}"><a
                                        href="{{pathFor 'static.about'}}">About</a></li>
                            {{/if}}

                        </ul>
                    </div>
                    <div class="top-bar-right">
                        {{#if currentUser}}
                            {{#unless hasUserAttributes}}
                                <a class="js-logout btn-secondary">Logout ({{currentUsername}})</a>
                            {{else}}
                                <ul class="menu">
                                    <li class="logo-height invisible">
                                        <!-- This needs to be the height of the logo in order to vertically align the other menu items -->
                                    </li>

                                    <li>
                                        <ul class="dropdown menu" data-dropdown-menu>
                                            <li class="has-submenu">
                                                <a href="{{pathFor 'notifications.page'}}"><span
                                                        class="circle-background-text">{{userNotificationsCount}}</span></a>
                                                <ul class="submenu menu vertical"
                                                    style="max-height: 500px; overflow-y: scroll;" data-submenu>
                                                    {{#each userNotifications}}
                                                        <li class="padded">
                                                            {{> notification_card}}
                                                        </li>
                                                        <hr>
                                                    {{/each}}

                                                    {{#if userHasNotifications}}
                                                        <li class="notifications-clear-all padded"><a>Clear all
                                                            notifications</a></li>
                                                    {{else}}
                                                        <li class="padded">You don't have any notifications</li>
                                                    {{/if}}
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>

                                    <li>
                                        <ul class="dropdown menu push-left" data-dropdown-menu>
                                            <li class="has-submenu">
                                                <a href="{{pathFor 'profile.page' username=currentUsername}}"
                                                   class="js-user-menu btn-secondary">
                                                    {{currentUsername}}
                                                </a>

                                                <ul class="submenu menu vertical" data-submenu>
                                                    <!--<li>
                                                <a href="{{pathFor 'profile.page' username=currentUsername}}"
                                                   class="btn-secondary">{{_ 'My profile'}}</a>
                                            </li>-->
                                                    <li>
                                                        <a href="{{pathFor 'profile.projects' username=currentUsername}}">My
                                                            projects</a>
                                                    </li>
                                                    <li>
                                                        <a href="{{pathFor 'exchanges.user' username=currentUsername}}">My
                                                            exchanges</a>
                                                    </li>
                                                    <li>
                                                        <a href="{{pathFor 'chatSessions.list'}}">My messages</a>
                                                    </li>
                                                    <li>
                                                        <a href="{{pathFor 'static.donate'}}">{{_ 'Donate'}}</a>
                                                    </li>
                                                    <li>
                                                        <a class="js-logout btn-secondary">{{_ 'Logout'}}</a>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            {{/unless}}
                        {{else}}
                            <ul class="menu button-group">
                                <li class="logo-height invisible">
                                    <!-- This needs to be the height of the logo in order to vertically align the other menu items -->
                                </li>
                                <li>
                                    <a href="{{pathFor 'signin'}}" class="button-light">
                                        <span>
                                            {{_ 'Sign In'}}
                                        </span>
                                    </a>
                                </li>

                                <li>
                                    <a href="{{pathFor 'join'}}" class="button-light">
                                        <span>
                                            {{_ 'Join'}}
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        {{/if}}

                    </div>
                </div>

                <!-- original content goes in this container -->
                <div class="off-canvas-content" data-off-canvas-content>
                    <div class="">
                        {{#unless connected}}
                            <div class="callout secondary pull-down">
                                {{{loadingIcon}}}
                                <div>Trying to connect</div>
                                <div>There seems to be a connection issue</div>
                            </div>
                        {{/unless}}

                        <div class="content-overlay"></div>

                        <div id="content-container">
                            {{#momentum plugin="fade"}}

                                {{>temporary_notifications}}

                                {{#if Template.subscriptionsReady}}

                                    {{#if currentUser}}
                                        {{#unless hasUserAttributes}}
                                            {{> user_attributes_insert_page}}
                                        {{else}}
                                            {{> Template.dynamic template=main}}
                                            {{> footer_card}}
                                        {{/unless}}
                                    {{else}}
                                        {{> Template.dynamic template=main}}
                                        {{> footer_card}}
                                    {{/if}}

                                {{else}}
                                    {{> App_loading}}
                                {{/if}}
                            {{/momentum}}
                        </div>
                    </div>
                </div>

                <!-- close wrapper, no more content after this -->
            </div>
        </div>

    {{/HammerTouchArea}}
</template>
